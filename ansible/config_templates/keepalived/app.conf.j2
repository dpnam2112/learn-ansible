# {{ ansible_managed }}
# Inputs:
#   - vrid: int (virtual_router_id)
#   - vip: string (e.g., "10.0.0.50/24 dev ens192" or "10.0.0.50")
#   - host-specific attributes:: vrrp_interface, vrrp_state, vrrp_priority
# Optional:
#   - vrrp_version (default 3), vrrp_advert_int (default 1)
#   - vrrp_preempt (bool); if false -> nopreempt; if true -> preempt_delay
#   - vrrp_preempt_delay (seconds, default 120)

vrrp_instance VI_{{ vrid }} {
  state {{ vrrp_state | default('BACKUP') }}
  interface {{ vrrp_interface }}
  virtual_router_id {{ vrid }}
  priority {{ vrrp_priority }}
  advert_int {{ vrrp_advert_int | default(1) }}
  version {{ vrrp_version | default(3) }}

  virtual_ipaddress {
    {{ vip }}
  }

  {# Preemption policy #}
  {% if vrrp_preempt is defined %}
    {% if not vrrp_preempt %}
  nopreempt
    {% else %}
  vrrp_preempt_delay {{ vrrp_preempt_delay | default(120) }}
    {% endif %}
  {% endif %}

  garp_master_delay 1
  garp_master_repeat 3
  garp_master_refresh 10
}

