Vagrant.configure("2") do |config|
  BOX = "generic/ubuntu2204"

  {
    "db"  => "192.168.56.11",
    "app" => "192.168.56.12",
    "db2" => "192.168.56.13",
    "app2" => "192.168.56.14",
  }.each do |name, ip|
    config.vm.define name do |node|
      node.vm.box = BOX
      node.vm.hostname = name

      node.vm.network "private_network",
        ip: ip,                                  # <-- use the loop var
        libvirt__network_name: "my-static-net",
        libvirt__dhcp_enabled: false,
        libvirt__netmask: "255.255.255.0",       # helps libvirt be explicit
        libvirt__forward_mode: "none"            # pure isolated network

      node.vm.provider :libvirt do |lv|
        lv.memory = 2048
        lv.cpus   = 2
      end

      node.vm.provision "shell", privileged: true, inline: <<-SHELL
        apt-get update -y
        apt-get install -y python3 python3-venv
      SHELL
    end
  end
end

